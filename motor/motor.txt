#include <Wire.h>

char motor_pow[4] = {0,0,0,0}; //for motor output
int counter = 0;
int motor_address = 0x14 >> 1;

void setup() {
  Serial.begin(9600);
  Wire.begin(); // join i2c bus
}

void loop() {
  int tmp = 340;
  char power = 0;
  if(counter < 3) {
    power = 40;
  } else if(counter < 4) {
    power = 0;
  } else if(counter < 7) {
    power = -40;
  } else if(counter < 8) {
    power = 0;
  }
  SetMotorValue(power, power, power, power);
  Move();
  counter = (++counter)%8;
  delay(500);
}

// Daisen 6ch(4 motor control board
// input val:-100~100 (0:stop, 999:brakes)
void SetMotorValue(char val1, char val2, char val3, char val4)
{
  char vals[4] = {val1, val2, val3, val4};
  for(int i=0; i<4; ++i)
  {
    if(vals[i] < 0 && vals[i] >= -100){
      vals[i] = abs(vals[i]);
      motor_pow[i] = vals[i] + 128;
    } else if(vals[i] >= 0 && vals[i] <= 100) {
      motor_pow[i] = vals[i];
    } else if(vals[i] == 999) {
      motor_pow[i] = 128;
    } else {
      return;
    }
  }
}

void Move(){
  Wire.beginTransmission(0x14>>1);
  Wire.write(motor_pow[0]);
  Wire.write(motor_pow[1]);
  Wire.write(motor_pow[2]);
  Wire.write(motor_pow[3]);
  Wire.write(0); // dummy
  Wire.write(0); // dummy
  Wire.endTransmission();
}